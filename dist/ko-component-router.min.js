!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("knockout")):"function"==typeof define&&define.amd?define(["knockout"],t):(e.ko=e.ko||{},e.ko.router=t(e.ko))}(this,function(e){"use strict";function t(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function u(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})}function n(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,u,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u}function r(e){return T(e)===!0&&"[object Object]"===Object.prototype.toString.call(e)}function i(e){return"function"==typeof e.splice}function o(e){return"boolean"==typeof e}function a(e){return"string"==typeof e}function u(e){return"function"==typeof e}function s(e){return void 0===e}function c(e,t){return e.reduce(function(e,n){var r=t(n);return e.concat(i(r)?r:[r])},[])}function l(e){for(var r=this,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var a=[],u=e.map(function(e){var o=d(e).apply(void 0,i),u=function(){return t(r,void 0,void 0,function(){var e,t;return n(this,function(n){switch(n.label){case 0:return e=o.next(),h(e)?[4,e]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t=e.value,n.label=3;case 3:return e=t,[2,e||!0]}})})};return a.push(u),u});return[p.apply(void 0,[u].concat(i)),function(){return p.apply(void 0,[u].concat(i))}]}function p(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return t(this,void 0,void 0,function(){var t,i,o;return n(this,function(n){switch(n.label){case 0:t=0,i=e,n.label=1;case 1:return t<i.length?(o=i[t],[4,b(o).apply(void 0,r)]):[3,4];case 2:if(n.sent()===!1)return[2,!1];n.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function f(e){return"GeneratorFunction"===e.constructor.name}function h(e){return!s(e)&&u(e.then)}function d(e){return f(e)?e:function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o,a=1;return{next:function(){return t(this,void 0,void 0,function(){var t,i,u,s,c;return n(this,function(n){switch(n.label){case 0:switch(t=a++){case 1:return[3,1];case 2:return[3,6];case 3:return[3,9];case 4:return[3,12]}return[3,15];case 1:return[4,b(e).apply(void 0,r)];case 2:return o=n.sent()||!1,o&&o.beforeRender?[4,b(o.beforeRender)()]:[3,4];case 3:return i=n.sent(),[3,5];case 4:i=o,n.label=5;case 5:return[2,i];case 6:return u=o,u?[4,b(o.afterRender)()]:[3,8];case 7:u=n.sent(),n.label=8;case 8:return[2,u];case 9:return s=o,s?[4,b(o.beforeDispose)()]:[3,11];case 10:s=n.sent(),n.label=11;case 11:return[2,s];case 12:return c=o,c?[4,b(o.afterDispose)()]:[3,14];case 13:c=n.sent(),n.label=14;case 14:return[2,c];case 15:return[2]}})})}}}}function b(e){var r=this;return void 0===e&&(e=v),function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return t(r,void 0,void 0,function(){var t,r,o;return n(this,function(n){switch(n.label){case 0:return t=function(){return e.length===i.length+1?new Promise(function(t){e.apply(void 0,i.concat([t]))}):e.apply(void 0,i)},r=t(),h(r)?[4,r]:[3,2];case 1:return o=n.sent(),[3,3];case 2:o=r,n.label=3;case 3:return[2,o]}})})}}function v(){}function g(e,t){for(var n,r=[],i=0,o=0,a="",u=t&&t.delimiter||"/";null!=(n=H.exec(e));){var s=n[0],c=n[1],l=n.index;if(a+=e.slice(o,l),o=l+s.length,c)a+=c[1];else{var p=e[o],f=n[2],h=n[3],d=n[4],b=n[5],v=n[6],g=n[7];a&&(r.push(a),a="");var m=null!=f&&null!=p&&p!==f,y="+"===v||"*"===v,w="?"===v||"*"===v,k=n[2]||u,P=d||b;r.push({name:h||i++,prefix:f||"",delimiter:k,optional:w,repeat:y,partial:m,asterisk:!!g,pattern:P?$(P):g?".*":"[^"+x(k)+"]+?"})}}return o<e.length&&(a+=e.substr(o)),a&&r.push(a),r}function m(e,t){return k(g(e,t))}function y(e){return encodeURI(e).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function w(e){return encodeURI(e).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function k(e){for(var t=new Array(e.length),n=0;n<e.length;n++)"object"==typeof e[n]&&(t[n]=new RegExp("^(?:"+e[n].pattern+")$"));return function(n,r){for(var i="",o=n||{},a=r||{},u=a.pretty?y:encodeURIComponent,s=0;s<e.length;s++){var c=e[s];if("string"!=typeof c){var l,p=o[c.name];if(null==p){if(c.optional){c.partial&&(i+=c.prefix);continue}throw new TypeError('Expected "'+c.name+'" to be defined')}if(F(p)){if(!c.repeat)throw new TypeError('Expected "'+c.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(c.optional)continue;throw new TypeError('Expected "'+c.name+'" to not be empty')}for(var f=0;f<p.length;f++){if(l=u(p[f]),!t[s].test(l))throw new TypeError('Expected all "'+c.name+'" to match "'+c.pattern+'", but received `'+JSON.stringify(l)+"`");i+=(0===f?c.prefix:c.delimiter)+l}}else{if(l=c.asterisk?w(p):u(p),!t[s].test(l))throw new TypeError('Expected "'+c.name+'" to match "'+c.pattern+'", but received "'+l+'"');i+=c.prefix+l}}else i+=c}return i}}function x(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function $(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function P(e,t){return e.keys=t,e}function C(e){return e.sensitive?"":"i"}function R(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)t.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return P(e,t)}function _(e,t,n){for(var r=[],i=0;i<e.length;i++)r.push(j(e[i],t,n).source);return P(new RegExp("(?:"+r.join("|")+")",C(n)),t)}function O(e,t,n){return E(g(e,n),t,n)}function E(e,t,n){F(t)||(n=t||n,t=[]),n=n||{};for(var r=n.strict,i=n.end!==!1,o="",a=0;a<e.length;a++){var u=e[a];if("string"==typeof u)o+=x(u);else{var s=x(u.prefix),c="(?:"+u.pattern+")";t.push(u),u.repeat&&(c+="(?:"+s+c+")*"),c=u.optional?u.partial?s+"("+c+")?":"(?:"+s+"("+c+"))?":s+"("+c+")",o+=c}}var l=x(n.delimiter||"/"),p=o.slice(-l.length)===l;return r||(o=(p?o.slice(0,-l.length):o)+"(?:"+l+"(?=$))?"),o+=i?"$":r&&p?"":"(?="+l+"|$)",P(new RegExp("^"+o,C(n)),t)}function j(e,t,n){return F(t)||(n=t||n,t=[]),n=n||{},e instanceof RegExp?R(e,t):F(e)?_(e,t,n):O(e,t,n)}function A(e,t){var n=N(e,t),r=n[0],i=n[1];return r.base+i}function D(e,t){var n=N(e,t),r=n[0],i=n[1];return!r.isNavigating()&&(r.ctx.pathname||"/")==="/"+i.split("/")[1]}function N(e,t){var n=S(e);if(0===t.indexOf("//"))for(t=t.replace("//","/");!n.isRoot;)n=n.$parent;else for(0===t.indexOf("./")&&(t=t.replace("./","/"),n=n.$child);t&&t.match(/\/?\.\./i)&&!n.isRoot;)n=n.$parent,t=t.replace(/\/?\.\./i,"");return[n,t]}function S(e){for(;!s(e);){if(!s(e.$router))return e.$router;e=e.$parentContext}return X.get(0)}var B=function(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)},T=B,L=function(e){var t,n;return r(e)!==!1&&(t=e.constructor,"function"==typeof t&&(n=t.prototype,r(n)!==!1&&n.hasOwnProperty("isPrototypeOf")!==!1))},U=function(){function e(e){Object.assign(this,e),this.fullPath=this.router.base+this.pathname,this.canonicalPath=this.fullPath.replace(new RegExp(this.router.$root.base,"i"),""),this._queue=[],this._beforeNavigateCallbacks=[],this._afterRenderCallbacks=[],this._beforeDisposeCallbacks=[],this._afterDisposeCallbacks=[]}return e.prototype.addBeforeNavigateCallback=function(e){this._beforeNavigateCallbacks.unshift(e)},Object.defineProperty(e.prototype,"$parent",{get:function(){return this.router.isRoot?void 0:this.router.$parent.ctx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$parents",{get:function(){return this.router.$parents.map(function(e){return e.ctx})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$child",{get:function(){return s(this.router.$child)?void 0:this.router.$child.ctx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$children",{get:function(){return this.router.$children.filter(function(e){return!s(e.ctx)}).map(function(e){return e.ctx})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return document.getElementsByClassName("ko-component-router-view")[this.router.depth]},enumerable:!0,configurable:!0}),e.prototype.runBeforeNavigateCallbacks=function(){return t(this,void 0,void 0,function(){var e,t;return n(this,function(n){switch(n.label){case 0:for(e=this,t=[];e;)t=e._beforeNavigateCallbacks.concat(t),e=e.$child;return[4,p(t)];case 1:return[2,n.sent()]}})})},e.prototype.queue=function(e){this._queue.push(e)},e.prototype.flushQueue=function(){return t(this,void 0,void 0,function(){var e=this;return n(this,function(t){switch(t.label){case 0:return[4,Promise.all(this._queue).then(function(){return e._queue=[]})];case 1:return t.sent(),[2]}})})},e.prototype.runBeforeRender=function(){return t(this,void 0,void 0,function(){var e,t,r,i,o,a;return n(this,function(n){switch(n.label){case 0:return e=l(X.middleware,this),t=e[0],r=e[1],this._afterRenderCallbacks.push(r),this._beforeDisposeCallbacks.push(r),this._afterDisposeCallbacks.push(r),[4,t];case 1:return n.sent(),i=l(this.route.middleware,this),o=i[0],a=i[1],this._afterRenderCallbacks.push(a),this._beforeDisposeCallbacks.unshift(a),this._afterDisposeCallbacks.unshift(a),[4,o];case 2:return n.sent(),[4,this.flushQueue()];case 3:return n.sent(),[2]}})})},e.prototype.runAfterRender=function(){return t(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,p(this._afterRenderCallbacks)];case 1:return e.sent(),[4,this.flushQueue()];case 2:return e.sent(),[2]}})})},e.prototype.runBeforeDispose=function(){return t(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return this.$child?[4,this.$child.runBeforeDispose()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,p(this._beforeDisposeCallbacks)];case 3:return e.sent(),[4,this.flushQueue()];case 4:return e.sent(),[2]}})})},e.prototype.runAfterDispose=function(){return t(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,p(this._afterDisposeCallbacks)];case 1:return e.sent(),[4,this.flushQueue()];case 2:return e.sent(),[2]}})})},e}(),q=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},F=q,Q=j,z=g,I=m,K=k,G=E,H=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");Q.parse=z,Q.compile=I,Q.tokensToFunction=K,Q.tokensToRegExp=G;var J=function(){function e(t,n){var r=e.parseConfig(n),i=r[0],o=r[1],a=r[2];this.path=t,this.component=i,this.middleware=o,this.children=a;var u=e.parsePath(t,!s(a)),c=u[0],l=u[1];this.keys=c,this.regexp=l}return e.prototype.matches=function(e){var t=this.regexp.exec(e);if(null===t)return!1;if(this.children){for(var n=0,r=this.children;n<r.length;n++){var i=r[n],o="/"+(t[t.length-1]||"");if(i.matches(o))return!0}return!1}return!0},e.prototype.parse=function(e){for(var t,n={},r=this.regexp.exec(e),i=1,o=r.length;i<o;++i){var a=this.keys[i-1],u=r[i]||"";"__child_path__"===a.name?t="/"+u:n[a.name]=u}return[n,e.replace(new RegExp(t+"$"),""),t]},e.parseConfig=function(t){var n,r,i=t.reduce(function(t,i){return a(i)?(i=i,n=i):L(i)?(i=i,r=Object.entries(i).map(function(t){return new e(t[0],t[1])}),n||(n="ko-component-router")):u(i)&&(i=i,t.push(i)),t},[]);return[n,i,r]},e.parsePath=function(e,t){t&&(e=e.replace(/\/?!?$/,"/!")),e="!"===e[e.length-1]?e.replace("!",":__child_path__(.*)?"):e.replace(/\(?\*\)?/,"(.*)");var n=[];return[n,Q(e,n)]},e}(),M={click:document.ontouchstart?"touchstart":"click",popstate:"popstate"},V=[],W=[],X=function(){function r(){var t=this;this.component=e.observable(null),this.isNavigating=e.observable(!0),r.link(this),this.isRoot?(this.routes=r.createRoutes(r.routes),document.addEventListener(M.click,r.onclick),window.addEventListener(M.popstate,r.onpopstate)):this.$parent.ctx.route.children&&(this.routes=this.$parent.ctx.route.children),this.update(this.getPathFromLocation(),!1).then(function(){return V.forEach(function(e){return e(t)})})}return Object.defineProperty(r.prototype,"base",{get:function(){return this.isRoot?r.config.base+(r.config.hashbang?"/#!":""):this.$parent.base+this.$parent.ctx.pathname},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"$root",{get:function(){return W[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"$parent",{get:function(){return W[this.depth-1]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"$parents",{get:function(){return W.slice(0,this.depth).reverse()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"$child",{get:function(){return W[this.depth+1]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"$children",{get:function(){return W.slice(this.depth+1)},enumerable:!0,configurable:!0}),r.prototype.update=function(i,a){return t(this,void 0,void 0,function(){var t,u,c,l,p,f,h,d,b,v,g,m,y,w,k,x,$;return n(this,function(n){switch(n.label){case 0:return t=this.ctx,o(u)?u={push:a}:s(u)&&(u={}),s(u.push)&&(u.push=!0),s(u.with)&&(u.with={}),c=r.parseUrl(i),l=c.search,p=c.hash,f=r.getPath(i),(h=this.resolveRoute(f))?(d=h.parse(f),b=d[0],v=d[1],g=d[2],!t||t.pathname!==v||u.force?[3,3]:this.$child?[4,this.$child.update(g+l+p,u)]:[3,2]):[2,!1];case 1:return[2,n.sent()];case 2:return[2,!1];case 3:return t?[4,t.runBeforeNavigateCallbacks()]:[3,5];case 4:if(m=n.sent(),m===!1)return[2,!1];this.isNavigating(!0),n.label=5;case 5:return history[u.push?"pushState":"replaceState"](history.state,document.title,this.base+f+l+p),y=new U(Object.assign({},u.with,this.passthrough,{router:this,params:b,route:h,path:f,pathname:v})),t?[4,t.runBeforeDispose()]:[3,7];case 6:n.sent(),n.label=7;case 7:return w=t&&t.$children.reverse(),[4,y.runBeforeRender()];case 8:if(n.sent(),this.ctx=y,this.component(null),e.tasks.runEarly(),this.component(this.ctx.route.component),e.tasks.runEarly(),!t)return[3,14];k=0,x=w,n.label=9;case 9:return k<x.length?($=x[k],[4,$.runAfterDispose()]):[3,12];case 10:n.sent(),n.label=11;case 11:return k++,[3,9];case 12:return[4,t.runAfterDispose()];case 13:n.sent(),n.label=14;case 14:return[4,y.runAfterRender()];case 15:return n.sent(),this.isNavigating(!1),[2,!0]}})})},r.prototype.resolveRoute=function(e){var t,n=1/0;for(var r in this.routes){var i=this.routes[r];if(i.matches(e)){if(0===i.keys.length)return i;(n===1/0||i.keys.length<n&&".*"!==i.keys[0].pattern)&&(n=i.keys.length,t=i)}}return t},r.prototype.getPathFromLocation=function(){var e=location.pathname+location.search+location.hash,t=this.base.replace("#!","#?!?");return e.replace(new RegExp(t,"i"),"")},r.prototype.dispose=function(){var e=this;r.unlink(),this.isRoot&&(document.removeEventListener(M.click,r.onclick,!1),window.removeEventListener(M.popstate,r.onpopstate,!1),this.ctx.runBeforeDispose().then(function(){return e.ctx.runAfterDispose()}))},r.setConfig=function(e){var t=e.base,n=e.hashbang,i=e.activePathCSSClass;t&&(r.config.base=t),n&&(r.config.hashbang=n),i&&(r.config.activePathCSSClass=i)},r.use=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(n=r.middleware).push.apply(n,e);var n},r.usePlugin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(n=r.plugins).push.apply(n,e);var n},r.useRoutes=function(e){Object.assign(r.routes,e)},r.get=function(e){return W[e]},Object.defineProperty(r,"head",{get:function(){return W[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"tail",{get:function(){return W[W.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"initialized",{get:function(){return 0===W.length?new Promise(function(e){return V.push(e)}):Promise.resolve(r.head)},enumerable:!0,configurable:!0}),r.update=function(e,r){return t(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return[4,W[0].update(e,r)];case 1:return[2,t.sent()]}})})},r.link=function(e){e.depth=W.length,e.isRoot=0===e.depth,W.push(e)},r.unlink=function(){W.pop()},r.onclick=function(e){if(!e.defaultPrevented){for(var t=e.target;t&&"A"!==t.nodeName;)t=t.parentNode;if(t&&"A"===t.nodeName){var n=t.pathname,i=t.search,o=t.hash,a=void 0===o?"":o,u=(n+i+a).replace(new RegExp(W[0].base,"i"),""),s=r.hasRoute(u),c=!r.sameOrigin(t.href),l=1!==r.which(e),p=t.hasAttribute("download"),f="#"===t.getAttribute("href"),h=0===(t.getAttribute("href")||"").indexOf("mailto:"),d="external"===t.getAttribute("rel"),b=e.metaKey||e.ctrlKey||e.shiftKey,v=t.hasAttribute("target");!s||c||l||p||f||h||d||b||v||(r.update(u),e.preventDefault())}}},r.onpopstate=function(e){r.update(W[0].getPathFromLocation(),!1),e.preventDefault()},r.canonicalizePath=function(e){return e.replace(new RegExp("/?#?!?/?"),"/")},r.parseUrl=function(e){var t=document.createElement("a"),n=W[0].base.toLowerCase();return n&&0===e.toLowerCase().indexOf(n)&&(e=e.replace(new RegExp(n,"i"),"")||"/"),t.href=r.canonicalizePath(e),{hash:t.hash,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname,search:t.search}},r.getPath=function(e){return r.parseUrl(e).pathname},r.hasRoute=function(e){return!s(r.head.resolveRoute(r.getPath(e)))},r.createRoutes=function(e){return Object.entries(r.routes).map(function(e){var t=e[0],n=e[1];return new J(t,r.runPlugins(n))})},r.runPlugins=function(e){return c(i(e)?e:[e],function(e){var t=r.plugins.reduce(function(t,n){var r=n(e);return r?t.concat(i(r)?r:[r]):t},[]);return t.length>0?t:e})},r.sameOrigin=function(e){var t=location.hostname,n=location.port,r=location.protocol,i=r+"//"+t;return n&&(i+=":"+n),e&&0===e.indexOf(i)},r.which=function(e){return e=e||window.event,null===e.which?e.button:e.which},r}();return X.config={base:"",hashbang:!1,activePathCSSClass:"active-path"},e.bindingHandlers.path={init:function(t,n,r,i,o){var a=r.get("pathActiveClass")||X.config.activePathCSSClass;X.initialized.then(function(){e.tasks.schedule(function(){return e.applyBindingsToNode(t,{attr:{href:e.pureComputed(function(){return A(o,e.unwrap(n()))})},css:(r={},r[a]=e.pureComputed(function(){return D(o,e.unwrap(n()))}),r)});var r})})}},e.components.register("ko-component-router",{synchronous:!0,viewModel:X,template:'<div data-bind="if: component">\n      <div class="ko-component-router-view" data-bind="__ko_component_router__"></div>\n    </div>'}),e.bindingHandlers.__ko_component_router__={init:function(t,n,r,i,o){var a=o.$rawData;return e.applyBindingsToNode(t,{css:a.component,component:{name:a.component,params:a.ctx}},o.extend({$router:a})),{controlsDescendantBindings:!0}}},X});